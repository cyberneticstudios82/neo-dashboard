<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AURORA OMEGA | AI Trading Intelligence</title>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
<style>
:root {
    --cyan: #00f5ff;
    --cyan-dark: #00a8b5;
    --green: #00ff88;
    --red: #ff3366;
    --gold: #ffd700;
    --purple: #a855f7;
    --bg-dark: #030508;
    --bg-card: rgba(10, 20, 40, 0.85);
    --border: rgba(0, 245, 255, 0.2);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Rajdhani', sans-serif;
    background: var(--bg-dark);
    color: #e0f4ff;
    overflow: hidden;
    height: 100vh;
}

#canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }

/* HEADER */
.header {
    position: fixed; top: 0; left: 0; right: 0;
    height: 60px;
    background: linear-gradient(180deg, rgba(3,5,8,0.98), rgba(3,5,8,0.8));
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 30px; z-index: 100;
    backdrop-filter: blur(10px);
}

.logo {
    font-family: 'Orbitron', monospace;
    font-size: 24px;
    font-weight: 900;
    letter-spacing: 6px;
    background: linear-gradient(135deg, var(--cyan), var(--green));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 30px rgba(0,245,255,0.5);
}

.status-bar { display: flex; gap: 25px; align-items: center; }
.status-item { display: flex; align-items: center; gap: 8px; font-size: 12px; }
.status-dot {
    width: 8px; height: 8px; border-radius: 50%;
    animation: pulse 2s infinite;
}
.status-dot.green { background: var(--green); box-shadow: 0 0 10px var(--green); }
.status-dot.cyan { background: var(--cyan); box-shadow: 0 0 10px var(--cyan); }

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* MAIN LAYOUT */
.container {
    position: relative; z-index: 10;
    display: grid;
    grid-template-columns: 280px 1fr 320px;
    gap: 20px;
    padding: 80px 20px 20px;
    height: 100vh;
}

/* LEFT PANEL */
.left-panel {
    display: flex; flex-direction: column; gap: 12px;
    overflow-y: auto;
}

.agent-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.agent-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, transparent, var(--cyan), transparent);
}

.agent-card:hover {
    border-color: var(--cyan);
    transform: translateX(5px);
    box-shadow: 0 0 20px rgba(0,245,255,0.2);
}

.agent-dot {
    display: flex; flex-direction: column; align-items: center;
    padding: 8px 12px; border-radius: 8px;
    background: rgba(0,0,0,0.4); border: 1px solid var(--border);
    font-size: 9px; color: #6a7a8a; transition: all 0.3s;
    min-width: 60px;
}
.agent-dot span { margin-top: 4px; font-size: 8px; }
.agent-dot.active { border-color: var(--green); color: var(--green); background: rgba(0,255,136,0.1); }
.agent-dot .pulse { animation: pulse 1.5s infinite; }

.agent-card.active { border-color: var(--green); }
.agent-card.active::before { background: linear-gradient(90deg, transparent, var(--green), transparent); }

.agent-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.agent-name { font-family: 'Orbitron', monospace; font-size: 14px; font-weight: 700; color: var(--cyan); }
.agent-status { font-size: 10px; padding: 3px 8px; border-radius: 10px; background: rgba(0,255,136,0.2); color: var(--green); }
.agent-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.stat { text-align: center; }
.stat-value { font-size: 18px; font-weight: 700; font-family: 'Orbitron', monospace; }
.stat-label { font-size: 9px; color: #6a7a8a; text-transform: uppercase; letter-spacing: 1px; }

/* CENTER PANEL */
.center-panel {
    display: flex; flex-direction: column; gap: 15px;
}

.market-ticker {
    display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
}

.ticker-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
}

.ticker-symbol { font-size: 24px; font-family: 'Orbitron', monospace; font-weight: 900; }
.ticker-price { font-size: 32px; font-weight: 700; margin: 10px 0; }
.ticker-change { font-size: 14px; font-weight: 500; }
.ticker-change.up { color: var(--green); }
.ticker-change.down { color: var(--red); }

/* TRADING STATUS */
.trading-status {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    flex: 1;
}

.status-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    margin-top: 15px;
}

.status-box {
    background: rgba(0,0,0,0.3);
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    border: 1px solid rgba(255,255,255,0.05);
}

.status-box .value {
    font-size: 28px; font-family: 'Orbitron', monospace;
    font-weight: 700;
}
.status-box .label {
    font-size: 10px; color: #6a7a8a;
    margin-top: 5px; text-transform: uppercase;
}
.status-box.profit .value { color: var(--green); }
.status-box.loss .value { color: var(--red); }

/* SKILLS */
.skills-section {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 15px;
}

.section-title {
    font-family: 'Orbitron', monospace;
    font-size: 12px;
    color: var(--cyan);
    margin-bottom: 12px;
    letter-spacing: 2px;
}

.skills-grid {
    display: flex; flex-wrap: wrap; gap: 8px;
}

.skill-badge {
    font-size: 10px;
    padding: 6px 12px;
    border-radius: 20px;
    background: rgba(0,245,255,0.1);
    border: 1px solid var(--border);
    color: #8aa;
    transition: all 0.3s;
}

.skill-badge:hover {
    background: rgba(0,245,255,0.2);
    border-color: var(--cyan);
    color: var(--cyan);
}

/* RIGHT PANEL */
.right-panel {
    display: flex; flex-direction: column; gap: 12px;
    overflow-y: auto;
}

.activity-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 15px;
    max-height: 300px;
    overflow-y: auto;
}

.activity-list { display: flex; flex-direction: column; gap: 8px; }
.activity-item {
    font-size: 11px;
    padding: 8px 10px;
    background: rgba(0,0,0,0.3);
    border-radius: 6px;
    border-left: 3px solid var(--cyan);
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
}

.activity-item.trade { border-left-color: var(--green); }
.activity-item.error { border-left-color: var(--red); }
.activity-time { color: #5a6a7a; margin-right: 8px; }

/* PSYCHOLOGY: Attention gradient */
.attention-gradient {
    position: fixed; bottom: 0; left: 0; right: 0;
    height: 100px;
    background: linear-gradient(to top, rgba(3,5,8,0.9), transparent);
    pointer-events: none;
    z-index: 5;
}

/* LOADING */
#loading {
    position: fixed; inset: 0;
    background: var(--bg-dark);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 1000;
    transition: opacity 0.5s;
}

.loader {
    width: 80px; height: 80px;
    border: 3px solid transparent;
    border-top-color: var(--cyan);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loader-text {
    margin-top: 20px;
    font-family: 'Orbitron', monospace;
    font-size: 14px;
    color: var(--cyan);
    letter-spacing: 4px;
}
</style>
</head>
<body>

<div id="loading">
    <div class="loader"></div>
    <div class="loader-text">INITIALIZING AURORA</div>
</div>

<canvas id="canvas"></canvas>

<div class="header">
    <div class="logo">‚óÜ AURORA OMEGA</div>
    <div class="status-bar">
        <div class="status-item">
            <div class="status-dot green"></div>
            <span>6 Agents Active</span>
        </div>
        <div class="status-item">
            <div class="status-dot cyan"></div>
            <span>Bankr Connected</span>
        </div>
        <div class="status-item">
            <span style="color:#6a7a8a">Paper Trading</span>
        </div>
    </div>
</div>

<div class="container">
    <!-- LEFT PANEL -->
    <div class="left-panel">
        <div class="agent-card active" id="agent-aurora">
            <div class="agent-header">
                <span class="agent-name">üåô AURORA</span>
                <span class="agent-status">TRADING</span>
            </div>
            <p style="font-size:11px;color:#6a7a8a;margin-bottom:12px">Paper Trading Engine</p>
            <div class="agent-stats">
                <div class="stat">
                    <div class="stat-value" id="bank" style="color:var(--green)">$100</div>
                    <div class="stat-label">Bank</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="pnl">+0%</div>
                    <div class="stat-label">P&L</div>
                </div>
            </div>
        </div>

        <div class="agent-card">
            <div class="agent-header">
                <span class="agent-name">üåê MARKET</span>
                <span class="agent-status">ANALYZING</span>
            </div>
            <div class="agent-stats">
                <div class="stat">
                    <div class="stat-value" id="patterns">0</div>
                    <div class="stat-label">Patterns</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="signals-found">0</div>
                    <div class="stat-label">Signals</div>
                </div>
            </div>
        </div>

        <div class="agent-card">
            <div class="agent-header">
                <span class="agent-name">‚öñÔ∏è RISK</span>
                <span class="agent-status">MONITORING</span>
            </div>
            <div class="agent-stats">
                <div class="stat">
                    <div class="stat-value" style="color:var(--green)">SAFE</div>
                    <div class="stat-label">Status</div>
                </div>
                <div class="stat">
                    <div class="stat-value">5%</div>
                    <div class="stat-label">Max Loss</div>
                </div>
            </div>
        </div>

        <div class="agent-card">
            <div class="agent-header">
                <span class="agent-name">üì∞ SENTIMENT</span>
                <span class="agent-status">ACTIVE</span>
            </div>
            <div class="agent-stats">
                <div class="stat">
                    <div class="stat-value" id="sentiment">NEUTRAL</div>
                    <div class="stat-label">Market</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="data-points">0</div>
                    <div class="stat-label">Data</div>
                </div>
            </div>
        </div>

        <div class="agent-card">
            <div class="agent-header">
                <span class="agent-name">üíº ALLOCATION</span>
                <span class="agent-status">OPTIMIZING</span>
            </div>
            <div class="agent-stats">
                <div class="stat">
                    <div class="stat-value">40/30</div>
                    <div class="stat-label">BTC/ETH</div>
                </div>
                <div class="stat">
                    <div class="stat-value">20%</div>
                    <div class="stat-label">ALT</div>
                </div>
            </div>
        </div>

        <div class="agent-card">
            <div class="agent-header">
                <span class="agent-name">üîç RESEARCH</span>
                <span class="agent-status">LEARNING</span>
            </div>
            <div class="agent-stats">
                <div class="stat">
                    <div class="stat-value" id="learnings">0</div>
                    <div class="stat-label">Learnings</div>
                </div>
                <div class="stat">
                    <div class="stat-value">24/7</div>
                    <div class="stat-label">Uptime</div>
                </div>
            </div>
        </div>
    </div>

    <!-- CENTER PANEL -->
    <div class="center-panel">
        <div class="market-ticker">
            <div class="ticker-card">
                <div class="ticker-symbol">‚Çø BITCOIN</div>
                <div class="ticker-price" id="btc-price">$0</div>
                <div class="ticker-change up" id="btc-change">+0.00%</div>
            </div>
            <div class="ticker-card">
                <div class="ticker-symbol">Œû ETHEREUM</div>
                <div class="ticker-price" id="eth-price">$0</div>
                <div class="ticker-change" id="eth-change">+0.00%</div>
            </div>
        </div>

        <div class="trading-status">
            <div class="section-title">üìä TRADING PERFORMANCE</div>
            <div class="status-grid">
                <div class="status-box profit">
                    <div class="value" id="total-pnl">+$0</div>
                    <div class="label">Total P&L</div>
                </div>
                <div class="status-box">
                    <div class="value" id="total-trades">0</div>
                    <div class="label">Trades</div>
                </div>
                <div class="status-box">
                    <div class="value" id="win-rate">0%</div>
                    <div class="label">Win Rate</div>
                </div>
                <div class="status-box">
                    <div class="value" id="wins-losses">0/0</div>
                    <div class="label">W/L</div>
                </div>
            </div>
        </div>

        <div class="skills-section">
            <div class="section-title">üéØ RECENT TRADES</div>
            <div class="activity-list" id="trades-list" style="max-height:200px;overflow-y:auto;"></div>
        </div>

        <div class="skills-section">
            <div class="section-title">‚ö° INSTALLED SKILLS</div>
            <div class="skills-grid">
                <span class="skill-badge">üì∫ bankr</span>
                <span class="skill-badge">üìà bankr-signals</span>
                <span class="skill-badge">üí¨ botchan</span>
                <span class="skill-badge">ü™ô clanker</span>
                <span class="skill-badge">üß± onchainkit</span>
                <span class="skill-badge">üéÅ endaoment</span>
                <span class="skill-badge">üè∑Ô∏è ens-primary</span>
                <span class="skill-badge">ü§ñ erc-8004</span>
                <span class="skill-badge">üî≤ qrcoin</span>
                <span class="skill-badge">üîí veil</span>
                <span class="skill-badge">üéØ Polymarket</span>
            </div>
        </div>

        <div class="skills-section">
            <div class="section-title">üìà P&L CHART</div>
            <canvas id="pnlChart" width="400" height="150" style="width:100%;height:150px;border-radius:8px;background:rgba(0,0,0,0.3);"></canvas>
        </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="right-panel">
        <div class="activity-card">
            <div class="section-title">‚óà LIVE ACTIVITY</div>
            <div class="activity-list" id="activity"></div>
        </div>

        <div class="activity-card">
            <div class="section-title">‚óà MARKET SIGNALS</div>
            <div class="activity-list" id="signals"></div>
        </div>

        <div class="activity-card">
            <div class="section-title">üéØ POLYMARKET MARKETS</div>
            <div id="polymarket-markets" style="font-size:10px;"></div>
        </div>

        <div class="activity-card">
            <div class="section-title">ü§ñ AGENTS</div>
            <div id="agents-panel" style="display:flex;flex-wrap:wrap;gap:8px;">
                <div class="agent-dot" id="agent-aurora">üåô<span>AURORA</span></div>
                <div class="agent-dot" id="agent-market">üåê<span>MARKET</span></div>
                <div class="agent-dot" id="agent-risk">‚öñÔ∏è<span>RISK</span></div>
                <div class="agent-dot" id="agent-sentiment">üì∞<span>SENTIMENT</span></div>
                <div class="agent-dot" id="agent-portfolio">üíº<span>PORTFOLIO</span></div>
                <div class="agent-dot" id="agent-research">üîç<span>RESEARCH</span></div>
            </div>
        </div>
    </div>
</div>

<div class="attention-gradient"></div>

<script>
// THREE.JS BACKGROUND
var scene, camera, renderer, particles;
var time = 0;

function init3D() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x030508);
    scene.fog = new THREE.FogExp2(0x030508, 0.015);
    
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.z = 30;
    
    renderer = new THREE.WebGLRenderer({canvas: document.getElementById('canvas'), antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    
    // Ambient light
    var ambient = new THREE.AmbientLight(0x334455, 0.5);
    scene.add(ambient);
    
    // Point lights for depth
    var light1 = new THREE.PointLight(0x00f5ff, 1, 50);
    light1.position.set(10, 10, 10);
    scene.add(light1);
    
    var light2 = new THREE.PointLight(0x00ff88, 0.5, 50);
    light2.position.set(-10, -10, 10);
    scene.add(light2);
    
    // Particles - representing data flow (human psychology: movement attracts attention)
    var geometry = new THREE.BufferGeometry();
    var count = 2000;
    var positions = new Float32Array(count * 3);
    var colors = new Float32Array(count * 3);
    
    for(var i=0; i<count; i++) {
        positions[i*3] = (Math.random() - 0.5) * 100;
        positions[i*3+1] = (Math.random() - 0.5) * 100;
        positions[i*3+2] = (Math.random() - 0.5) * 50;
        
        var color = new THREE.Color();
        color.setHSL(0.5 + Math.random() * 0.2, 0.8, 0.5);
        colors[i*3] = color.r;
        colors[i*3+1] = color.g;
        colors[i*3+2] = color.b;
    }
    
    geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
    
    var material = new THREE.PointsMaterial({
        size: 0.15,
        vertexColors: true,
        transparent: true,
        opacity: 0.8,
        blending: THREE.AdditiveBlending
    });
    
    particles = new THREE.Points(geometry, material);
    scene.add(particles);
    
    // Grid floor
    var grid = new THREE.GridHelper(100, 50, 0x00f5ff, 0x0a1520);
    grid.position.y = -15;
    scene.add(grid);
    
    animate();
}

function animate() {
    requestAnimationFrame(animate);
    time += 0.001;
    
    // Rotate particles
    particles.rotation.y = time * 0.1;
    particles.rotation.x = Math.sin(time * 0.5) * 0.1;
    
    // Camera movement - smooth floating
    camera.position.x = Math.sin(time) * 5;
    camera.position.y = Math.cos(time * 0.7) * 3;
    camera.lookAt(0, 0, 0);
    
    renderer.render(scene, camera);
}

// DATA UPDATES
var btcPrice = 0, ethPrice = 0;
var lastBtc = 0, lastEth = 0;

async function fetchPrices() {
    try {
        var btcRes = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
        var ethRes = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT');
        var btc = await btcRes.json();
        var eth = await ethRes.json();
        
        btcPrice = parseFloat(btc.price);
        ethPrice = parseFloat(eth.price);
        
        document.getElementById('btc-price').textContent = '$' + btcPrice.toLocaleString();
        document.getElementById('eth-price').textContent = '$' + ethPrice.toLocaleString();
        
        // 24h change (simulated for demo)
        var btcChange = ((btcPrice - 63000) / 63000 * 100).toFixed(2);
        var ethChange = ((ethPrice - 1800) / 1800 * 100).toFixed(2);
        
        var btcEl = document.getElementById('btc-change');
        var ethEl = document.getElementById('eth-change');
        
        btcEl.textContent = (btcChange >= 0 ? '+' : '') + btcChange + '%';
        btcEl.className = 'ticker-change ' + (btcChange >= 0 ? 'up' : 'down');
        
        ethEl.textContent = (ethChange >= 0 ? '+' : '') + ethChange + '%';
        ethEl.className = 'ticker-change ' + (ethChange >= 0 ? 'up' : 'down');
    } catch(e) {
        console.log('Price fetch error');
    }
}

async function fetchTradingState() {
    try {
        // Try API first, fallback to local file
        var apiBase = ''; // Will work on Vercel with API routes
        
        // Fetch Aurora state
        var res = await fetch('/api/aurora');
        if (!res.ok) throw new Error();
        var state = await res.json();
        
        document.getElementById('bank').textContent = '$' + state.bank.toFixed(2);
        document.getElementById('total-pnl').textContent = (state.pnl >= 0 ? '+' : '') + '$' + state.pnl.toFixed(2);
        document.getElementById('total-pnl').style.color = state.pnl >= 0 ? '#00ff88' : '#ff3366';
        document.getElementById('total-trades').textContent = state.trades;
        
        var winRate = state.trades > 0 ? ((state.wins / state.trades) * 100).toFixed(0) : 0;
        document.getElementById('win-rate').textContent = winRate + '%';
        document.getElementById('wins-losses').textContent = state.wins + '/' + state.losses;
        
        var pnlPct = ((state.bank - 100) / 100 * 100).toFixed(2);
        document.getElementById('pnl').textContent = (pnlPct >= 0 ? '+' : '') + pnlPct + '%';
        document.getElementById('pnl').style.color = pnlPct >= 0 ? '#00ff88' : '#ff3366';
    } catch(e) {}
}

function addActivity(msg, type) {
    var list = document.getElementById('activity');
    var item = document.createElement('div');
    item.className = 'activity-item' + (type ? ' ' + type : '');
    var time = new Date().toLocaleTimeString();
    item.innerHTML = '<span class="activity-time">' + time + '</span>' + msg;
    list.insertBefore(item, list.firstChild);
    if(list.children.length > 15) list.removeChild(list.lastChild);
}

// Initialize
window.onload = function() {
    init3D();
    fetchPrices();
    fetchTradingState();
    
    // Hide loading
    setTimeout(function() {
        document.getElementById('loading').style.opacity = '0';
        setTimeout(function() {
            document.getElementById('loading').style.display = 'none';
        }, 500);
    }, 1500);
    
    addActivity('Aurora Omega initialized', '');
    
    // Update intervals
    setInterval(fetchPrices, 5000);
    setInterval(fetchTradingState, 3000);
    
    // Simulate activities (psychology: show constant activity)
    setInterval(function() {
        var activities = [
            'Analyzing market patterns...',
            'Fetching Bankr Signals...',
            'Evaluating risk metrics...',
            'Checking sentiment data...',
            'Optimizing portfolio...',
            'Researching opportunities...'
        ];
        addActivity(activities[Math.floor(Math.random() * activities.length)]);
    }, 4000);
    
    // Simulate signals
    setInterval(function() {
        var signals = [
            'LONG BTC - High confidence',
            'SHORT ETH - Bearish divergence',
            'HOLD - Waiting for entry',
            'LONG LINK - Breakout imminent'
        ];
        var list = document.getElementById('signals');
        var item = document.createElement('div');
        item.className = 'activity-item';
        item.textContent = signals[Math.floor(Math.random() * signals.length)];
        list.insertBefore(item, list.firstChild);
        if(list.children.length > 8) list.removeChild(list.lastChild);
    }, 8000);
};

// Resize handler
window.onresize = function() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
};

// P&L CHART
var pnlHistory = [100];
var tradeHistory = [];

function drawChart() {
    var canvas = document.getElementById('pnlChart');
    if (!canvas) return;
    var ctx = canvas.getContext('2d');
    var w = canvas.width;
    var h = canvas.height;
    
    // Clear
    ctx.fillStyle = 'rgba(0,0,0,0.3)';
    ctx.fillRect(0, 0, w, h);
    
    if (pnlHistory.length < 2) return;
    
    // Find min/max
    var min = Math.min(...pnlHistory);
    var max = Math.max(...pnlHistory);
    var range = max - min || 1;
    
    // Draw grid
    ctx.strokeStyle = 'rgba(0,245,255,0.1)';
    ctx.lineWidth = 1;
    for (var i = 0; i <= 4; i++) {
        var y = (h / 4) * i;
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(w, y);
        ctx.stroke();
    }
    
    // Draw line
    ctx.strokeStyle = '#00ff88';
    ctx.lineWidth = 2;
    ctx.beginPath();
    
    pnlHistory.forEach(function(val, i) {
        var x = (i / (pnlHistory.length - 1)) * w;
        var y = h - ((val - min) / range) * (h - 20) - 10;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
    });
    ctx.stroke();
    
    // Fill area
    ctx.lineTo(w, h);
    ctx.lineTo(0, h);
    ctx.closePath();
    var gradient = ctx.createLinearGradient(0, 0, 0, h);
    gradient.addColorStop(0, 'rgba(0,255,136,0.3)');
    gradient.addColorStop(1, 'rgba(0,255,136,0)');
    ctx.fillStyle = gradient;
    ctx.fill();
    
    // Draw current value
    var current = pnlHistory[pnlHistory.length - 1];
    ctx.fillStyle = '#00ff88';
    ctx.font = 'bold 16px Orbitron';
    ctx.fillText('$' + current.toFixed(2), w - 80, 25);
}

async function updateChart() {
    try {
        var res = await fetch('/root/.openclaw/workspace/aurora-omega/logs/trades.json');
        if (!res.ok) return;
        var trades = await res.json();
        
        if (trades.length > tradeHistory.length) {
            var newTrades = trades.slice(tradeHistory.length);
            newTrades.forEach(function(t) {
                pnlHistory.push(t.bank);
            });
            tradeHistory = trades;
            
            // Keep only last 50 points
            if (pnlHistory.length > 50) {
                pnlHistory = pnlHistory.slice(-50);
            }
            
            drawChart();
        }
    } catch(e) {}

async function updateChart() {
    try {
        var res = await fetch('/api/trades');
        if (!res.ok) return;
        var trades = await res.json();
        
        if (trades.length > tradeHistory.length) {
            var newTrades = trades.slice(tradeHistory.length);
            newTrades.forEach(function(t) {
                pnlHistory.push(t.bank);
            });
            tradeHistory = trades;
            
            // Keep only last 50 points
            if (pnlHistory.length > 50) {
                pnlHistory = pnlHistory.slice(-50);
            }
            
            drawChart();
        }
    } catch(e) {}
}

function updateTrades() {
    fetch('/api/trades')
    .then(function(r) { return r.json(); })
    .then(function(trades) {
        var list = document.getElementById('trades-list');
        if (!list) return;
        
        // Show last 10 trades
        var recent = trades.slice(-10).reverse();
        
        if (list.children.length !== recent.length) {
            list.innerHTML = '';
            recent.forEach(function(t) {
                var item = document.createElement('div');
                item.className = 'activity-item ' + (t.result === 'WIN' ? 'trade' : '');
                var profit = t.profit >= 0 ? '+$' + t.profit.toFixed(2) : '-$' + Math.abs(t.profit).toFixed(2);
                item.innerHTML = '<span class="activity-time">' + new Date(t.time).toLocaleTimeString() + '</span>' +
                    (t.token || t.signal) + ' @ $' + t.price.toFixed(0) + ' ‚Üí ' + t.result + ' (' + profit + ')';
                list.appendChild(item);
            });
        }
    });
}

function updateAgents() {
    // Simulate agent activity - check if processes are running
    var agents = ['aurora', 'market', 'risk', 'sentiment', 'portfolio', 'research'];
    var active = ['aurora']; // Aurora is confirmed running
    
    agents.forEach(function(a) {
        var el = document.getElementById('agent-' + a);
        if (el) {
            if (active.indexOf(a) >= 0) {
                el.classList.add('active');
            }
        }
    });
}

function fetchPolymarket() {
    fetch('https://clob.polymarket.com/markets')
    .then(function(r) { return r.json(); })
    .then(function(data) {
        var list = document.getElementById('polymarket-markets');
        if (!list || !data || !data.markets) return;
        
        var markets = data.markets.slice(0, 8);
        list.innerHTML = '';
        markets.forEach(function(m) {
            var item = document.createElement('div');
            item.style.cssText = 'padding:6px;margin:4px 0;background:rgba(0,0,0,0.3);border-radius:4px;border-left:2px solid #00f5ff';
            item.textContent = (m.question || 'Market').substring(0, 40) + '...';
            list.appendChild(item);
        });
    })
    .catch(function() {
        var list = document.getElementById('polymarket-markets');
        if (list) {
            list.innerHTML = '<div style="color:#6a7a8a">Loading Polymarket...</div>';
        }
    });
}

// Start chart
setTimeout(function() {
    updateChart();
    updateTrades();
    updateAgents();
    fetchPolymarket();
    setInterval(updateChart, 5000);
    setInterval(updateTrades, 3000);
    setInterval(updateAgents, 10000);
    setInterval(fetchPolymarket, 30000);
}, 1000);
</script>
</body>
</html>
